<!--pages/service/errand/errand.wxml-->
<wxs module="utils">
  module.exports = {
    // 格式化金额显示
    formatPrice: function(price) {
      return isNaN(price) ? '0' : Number(price).toFixed(2);
    }
  }
</wxs>

<view class="errand-container">
  <!-- 顶部导航 -->
  <view class="header">
    <view class="page-title">跑腿代取</view>
  </view>
  
  <!-- 标签切换 -->
  <view class="tabs-container">
    <view 
      wx:for="{{tabs}}" 
      wx:key="value"
      class="tab-item {{currentTab === item.value ? 'active' : ''}}"
      bindtap="onTabChange"
      data-value="{{item.value}}"
    >
      {{item.label}}
    </view>
  </view>
  
  <!-- 主内容区域 -->
  <scroll-view 
    scroll-y 
    class="errand-list-container"
    bindscrolltolower="loadMoreErrand"
    enable-flex
    enhanced
    show-scrollbar="{{false}}"
  >
    <!-- 订单列表 -->
    <block wx:if="{{errandList.length > 0}}">
      <view 
        wx:for="{{errandList}}" 
        wx:key="id" 
        class="errand-card"
        bindtap="viewErrandDetail"
        data-id="{{item.id}}"
      >
        <view class="errand-header">
          <view class="errand-title">{{item.title}}</view>
          <view class="errand-price">¥{{utils.formatPrice(item.price)}}</view>
        </view>
        
        <view class="errand-info">
          <view class="errand-type">{{item.type}}</view>
          <view class="errand-time">截止: {{item.deadlineTime}}</view>
        </view>
        
        <view class="errand-locations">
          <view class="location-item">
            <view class="location-icon pickup"></view>
            <text>{{item.location}}</text>
          </view>
          <view class="location-arrow">
            <view class="arrow-line"></view>
          </view>
          <view class="location-item">
            <view class="location-icon dest"></view>
            <text>{{item.destination}}</text>
          </view>
        </view>
        
        <view class="errand-footer">
          <view class="publisher-info">
            <image class="publisher-avatar" src="{{item.publisher.avatar}}" mode="aspectFill"></image>
            <text class="publisher-name">{{item.publisher.name}}</text>
          </view>
          
          <view class="errand-status">
            <view class="status-tag {{item.status}}">{{item.status}}</view>
            
            <button 
              class="take-btn"
              catchtap="takeErrand"
              data-id="{{item.id}}"
              wx:if="{{item.status === '待接单' && currentTab !== 1}}"
            >接单</button>
          </view>
        </view>
      </view>
      
      <!-- 加载更多 -->
      <view class="loading-area" wx:if="{{loading}}">
        <view class="loading-dots">
          <view class="dot"></view>
          <view class="dot"></view>
          <view class="dot"></view>
        </view>
        <text>加载中...</text>
      </view>
      
      <!-- 无更多数据 -->
      <view class="no-more" wx:if="{{!hasMore && errandList.length > 0 && !loading}}">
        <text>- 没有更多了 -</text>
      </view>
    </block>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{isEmpty && !loading}}">
      <view class="empty-icon"></view>
      <text>暂无跑腿订单</text>
    </view>
  </scroll-view>
  
  <!-- 发布按钮 -->
  <view class="fab-button" bindtap="publishErrand">
    <view class="fab-icon">+</view>
  </view>
</view> 