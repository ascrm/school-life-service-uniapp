<!--pages/service/errand/errand.wxml-->
<view class="errand-container">
  <!-- 顶部导航栏 -->
  <t-navbar title="跑腿代取" titleMaxLength="{{10}}" class="custom-navbar">
  </t-navbar>
  
  <!-- 标签切换 -->
  <t-tabs
    defaultValue="{{currentTab}}"
    value="{{currentTab}}"
    bind:change="onTabChange"
    t-class="custom-tabs"
    sticky
  >
    <t-tab-panel 
      wx:for="{{tabs}}" 
      wx:key="value"
      label="{{item.label}}" 
      value="{{item.value}}" 
    />
  </t-tabs>
  
  <!-- 主内容区域 -->
  <scroll-view scroll-y class="scroll-container" bindscrolltolower="loadMoreErrand">
    <!-- 订单列表 -->
    <block wx:if="{{errandList.length > 0}}">
      <view 
        wx:for="{{errandList}}" 
        wx:key="id" 
        class="errand-card"
        bindtap="viewErrandDetail"
        data-id="{{item.id}}"
      >
        <view class="errand-header">
          <view class="errand-title">{{item.title}}</view>
          <view class="errand-price">¥{{item.price}}</view>
        </view>
        
        <view class="errand-info">
          <view class="errand-type-tag">
            <t-tag size="small" variant="light">{{item.type}}</t-tag>
          </view>
          <view class="errand-time">截止: {{item.deadlineTime}}</view>
        </view>
        
        <view class="errand-locations">
          <view class="location-item">
            <t-icon name="location" size="32rpx" />
            <text>{{item.location}}</text>
          </view>
          <view class="location-arrow">
            <t-icon name="arrow-right" size="28rpx" />
          </view>
          <view class="location-item">
            <t-icon name="home" size="32rpx" />
            <text>{{item.destination}}</text>
          </view>
        </view>
        
        <view class="errand-footer">
          <view class="publisher-info">
            <image class="publisher-avatar" src="{{item.publisher.avatar}}" mode="aspectFill"></image>
            <text class="publisher-name">{{item.publisher.name}}</text>
          </view>
          
          <view class="errand-status">
            <t-tag 
              size="small" 
              theme="{{item.status === '待接单' ? 'primary' : item.status === '进行中' ? 'warning' : item.status === '已完成' ? 'success' : 'default'}}"
            >
              {{item.status}}
            </t-tag>
            
            <t-button 
              size="small" 
              theme="primary" 
              shape="round"
              bindtap="takeErrand"
              data-id="{{item.id}}"
              wx:if="{{item.status === '待接单' && currentTab !== 1}}"
              catchtap
            >接单</t-button>
          </view>
        </view>
      </view>
      
      <!-- 加载更多 -->
      <view class="loading-area" wx:if="{{loading}}">
        <t-loading theme="dots" size="40rpx" text="加载中..." />
      </view>
      
      <!-- 无更多数据 -->
      <view class="no-more" wx:if="{{!hasMore && errandList.length > 0 && !loading}}">
        <text>- 没有更多了 -</text>
      </view>
    </block>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{isEmpty && !loading}}">
      <t-icon name="cart" size="96rpx" color="#cccccc" />
      <text>暂无跑腿订单</text>
    </view>
  </scroll-view>
  
  <!-- 发布按钮 -->
  <view class="fab-button" bindtap="publishErrand">
    <t-icon name="add" size="48rpx" color="#ffffff" />
  </view>
  
  <!-- 消息提示 -->
  <t-toast id="t-toast" />
</view> 